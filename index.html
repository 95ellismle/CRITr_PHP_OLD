<html>

<head>
  <meta content="text/html" charset="utf-8" />
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>CRITr</title>
  <style>
      html, body, #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
  </style>

  <!-- My Styling -->
  <link rel="stylesheet" type="text/css" href="style.css">
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <!-- Material Design Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <!-- ESRI (arcGIS maps) API and stylesheet -->
  <link rel="stylesheet" href="https://js.arcgis.com/4.12/esri/themes/light/main.css">
  <script src="https://js.arcgis.com/4.12/"></script>

  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 97%;
      width: 100%;
      font-family: verdana;
   }
   html {
      overflow-x: hidden;
      overflow-y: hidden;
      max-width: 100%;
      max-height: 100%;
    }

    #activitiesTitle {
        height: 4%;
        line-height: 3%;
        text-align: center;
    }
    
    .buttonLink, .buttonLink:hover, .buttonLink:active, .buttonLink:visited, .buttonLink:focus {
        text-decoration: none;
        outline: 0;
        border: 0;
    }

    .cardDiv {
        /*background-color: #f0f0f0;*/
        margin: 0;
    }

    #cardRow {
        overflow-y: scroll;
    }
    
    .cardTitle {
        font-size: 17px;
        text-align: left;
    }
    .cardTime, .cardDate {
        font-size: 15px;
    }
    .cardLoc {
        font-size: 14px;
        font-style: italic;
    }
    .cardPts {
        background-color: #006600;
        color: #ffffff;
        text-align: center;
        font-size: 12px;
        font-weight: 700;
    }

    #topbar {
      background: #fff;
      position: absolute;
      top: 15px;
      right: 15px;
      padding: 10px;
    }

    .action-button {
      font-size: 16px;
      background-color: transparent;
      border: 1px solid #D3D3D3;
      color: #6e6e6e;
      height: 32px;
      width: 32px;
      text-align: center;
      box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
    }

    .action-button:hover,
    .action-button:focus {
      background: #0079c1;
      color: #e4e4e4;
    }

    .active {
      background: #0079c1;
      color: #e4e4e4;
    }

  </style>

  <!-- The card javascript -->
  <script>
    function show2Rows() {
        var cardRow = document.getElementById("cardRow");
        var mapView = document.getElementById("viewDiv");
        
        if (cardRow.style.height == "30%") {
            cardRow.style.height= "4%";
            mapView.style.height = "97%";
        }
        else {
            cardRow.style.height= "30%";
            mapView.style.height = "70%";
        }
    }
  </script>

  <script>
  require([
      // The map
      "esri/Map",
      "esri/views/MapView",
      // Basemap toggle (satelite and nav view)
      "esri/widgets/BasemapToggle",
	  // Widget to find location of user
      "esri/widgets/Locate",
	  // Widget for Graphics
      "esri/Graphic",
	  "esri/layers/GraphicsLayer",
	  "esri/widgets/Sketch/SketchViewModel",
    ],
  function(Map, MapView, BasemapToggle, Locate, Graphic,
           GraphicsLayer, SketchViewModel) {

    let editGraphic;

	// Add the drop pin functionality
	const graphicsLayer = new GraphicsLayer({
		id: "dropPins"
	});

    const map = new Map({
      basemap: "streets-navigation-vector",
	  layers: [graphicsLayer]
    });

    // Set the map view and zoom to the Milnrow and Newhey
    const view = new MapView({
      container: "viewDiv",
      map: map,
      center: [-2.105367, 53.604835], // longitude, latitude
      zoom: 15
    });

    // Create the tools for dropping pins
    const pointSymbol = {
      type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
      style: "square",
      color: "#8A2BE2",
      size: "16px",
      outline: { // autocasts as new SimpleLineSymbol()
        color: [255, 255, 255],
         width: 3
      }
    };
    view.when(function() {
        // Create a new toolbar (sketchViewModel)
        const sketchViewModel = new SketchViewModel ({
            view,
            layer: graphicsLayer,
			pointSymbol,
        });
        
        setUpClickHandler();
		sketchViewModel.on("create-complete", addGraphic);
		sketchViewModel.on("update-complete", updateGraphic);
		sketchViewModel.on("update-cancel", updateGraphic);

		// Handles adding shapes (pins) to the map
		function addGraphic(event) {
			const graphic = new Graphic({
				geometry: event.geometry,
				symbol: sketchViewModel
			});
			graphicsLayer.add(graphic);
		}
		
		function updateGraphic(event) {
			var graphic = new Graphic({
				geometry: event.geometry,
				symbol: editGraphic.symbol
			});
			graphicsLayer.add(graphic);

			editGraphic = null;
		}
		
		function setUpClickHandler() {
	      view.on("click", function (event) {
	     	view.hitTest(event).then( function(response) {
	     	  var results = response.results;
	          if (results.length > 0) {
			    for (var i=0; i< results.length; i++) {
				  // Check if we're editting a graphic
				  if (!editGraphic && results[i].graphic.layer.id === "tempGraphics") {
					editGraphic = results[i].graphic;

					graphicsLayer.remove(editGraphic);
					sketchViewModel.update(editGraphic);
					break
				  }  
				}
	     	  }
	     	});
	      });
		}
		// Create the drop a pin button
		var drawPointButton = document.getElementById("pointButton");
		drawPointButton.onclick = function () {
			sketchViewModel.create("point");
			setActiveButton(this);
		}

        //function setActiveButton(selectedButton) {
        //    view.focus();
        //    var.elements = document.getElementById("active");
        //    for (var i=0; i<elements.length;  i++) {
        //        elements[i].classList.remove("active");
        //    }
        //    if (selectedButton) {
        //        selectedButton.classList.add("active");
        //    }
        //}

    });

    // Set the toggle between satelite and standard map
    var basemapToggle = new BasemapToggle({
      view: view,
      secondMap: "satellite"
    });
    view.ui.add(basemapToggle,"bottom-right");
	
	
	// Will add a widget to zoom into the user
    var locate = new Locate({
      view: view,
      useHeadingEnabled: false,
      goToOverride: function(view, options) {
        options.target.scale = 1500;  // Override the default map scale
        return view.goTo(options.target);
      }
    });

    view.ui.add(locate, "top-left");
/*
    // Will show the lattitude and longitude of the cursor
    var coordsWidget = document.createElement("div");
    coordsWidget.id = "coordsWidget";
    coordsWidget.className = "esri-widget esri-component";
    coordsWidget.style.padding = "7px 15px 5px";
  
    view.ui.add(coordsWidget, "bottom-right");
  
    function showCoordinates(pt) {
      var coords = "Lat/Lon " + pt.latitude.toFixed(3) + " " + pt.longitude.toFixed(3) +
          " | Scale 1:" + Math.round(view.scale * 1) / 1 +
          " | Zoom " + view.zoom;
      coordsWidget.innerHTML = coords;
    }	
  
    view.watch("stationary", function(isStationary) {
      showCoordinates(view.center);
    });
  
    view.on("pointer-move", function(evt) {
      showCoordinates(view.toMap({ x: evt.x, y: evt.y }));
    });
*/
  });
  </script>

</head>




<body>
    <div id="viewDiv">
		<div id="topbar">
      		<button class="action-button esri-icon-blank-map-pin" id="pointButton"
        			type="button" title="Draw point">
            </button>
    	</div>
    </div
</body>

<!-- Start the card interface -->
<a href="#" onclick='show2Rows()' class="buttonLink">
    <div class="row">
        <h1 id="activitiesTitle">Activities</h1>
    </div>
</a>
<div class="row col-sm-12" id="cardRow">
</div>
<script>
    activities = [
                  {'name': 'Evening Patrol', 'date': 'Monday', 'time': '18:00',
                   'location': 'Fayke street, North', 'points': 150, 'numPeople': 3,
                   'spacesTaken': 1},
                  {'name': 'Litter Picking', 'date': 'Wednesday', 'time': '15:30',
                   'location': 'Prettend Road, West', 'points': 50, 'numPeople': 2,
                   'spacesTaken': 0},
                  {'name': 'Litter Picking', 'date': 'Wednesday', 'time': '15:30',
                   'location': 'Prettend Road, West', 'points': 50, 'numPeople': 2,
                   'spacesTaken': 0},
                  {'name': 'Litter Picking', 'date': 'Wednesday', 'time': '15:30',
                   'location': 'Prettend Road, West', 'points': 50, 'numPeople': 2,
                   'spacesTaken': 0},
                  {'name': 'Litter Picking', 'date': 'Wednesday', 'time': '15:30',
                   'location': 'Prettend Road, West', 'points': 50, 'numPeople': 2,
                   'spacesTaken': 0},
                 ];
    
    // Will create the card div to add to the row at the bottom
    function createCard(dict, i) {
        var cardDiv = document.createElement("div");
        cardDiv.id = "card_" + i.toString();
        cardDiv.className = "cardDiv row";
        
        // Add the row break
        var rowBreak = document.createElement("hr");

        
        // First column (half size)
        var colDiv1_1 = document.createElement("div");
        colDiv1_1.className = "col-xs-6";

        // The title of the activity
        var title = document.createElement("p");
        title.innerHTML = dict['name'];
        title.className = "cardTitle";
        colDiv1_1.appendChild(title);

        // Second column (quarter)
        var colDiv2_1 = document.createElement("div");
        colDiv2_1.className = "col-xs-3";

        // Add the date
        var dateStr = document.createElement("p");
        dateStr.className = "cardDate";
        dateStr.innerHTML = dict['date'].slice(0, 3);
        colDiv2_1.appendChild(dateStr);

        // Third column (quarter)
        var colDiv3_1 = document.createElement("div");
        colDiv3_1.className = "col-xs-3";

        // Create the time
        var timeStr = document.createElement("p");
        timeStr.className = "cardTime";
        timeStr.innerHTML = dict['time'];
        colDiv3_1.appendChild(timeStr);

        // Create the first column (second row)
        colDiv1_2 = document.createElement("div");
        colDiv1_2.className = "col-xs-6";
        
        // Create the location
        var locStr = document.createElement("p");
        locStr.className = "cardLoc";
        locStr.innerHTML = dict['location'];
        colDiv1_2.appendChild(locStr);

        // Create the second column (second row)
        colDiv2_2 = document.createElement("div");
        colDiv2_2.className = "col-xs-3";

        // Create the location
        var ptsStr = document.createElement("p");
        ptsStr.className = "cardPts";
        ptsStr.innerHTML = dict['points'] + " pt";
        colDiv2_2.appendChild(ptsStr);

        // Create the third column (second row)
        colDiv3_2 = document.createElement("span");
        colDiv3_2.className = "col-xs-3";
        colDiv3_2.style.display = "inline-block";

        for (var i=0; i<dict['spacesTaken']; i++){ 
            icon = document.createElement("i");
            icon.className = "material-icons";
            icon.innerHTML = "person";
            icon.style.fontSize = "17px";
            colDiv3_2.appendChild(icon);
        }
        for (var i=0; i<(dict['numPeople'] - dict['spacesTaken']); i++) {
            icon = document.createElement("i");
            icon.className = "material-icons";
            icon.innerHTML = "person_outline";
            icon.style.fontSize = "17px";
            colDiv3_2.appendChild(icon);
        }

        row1 = document.createElement("div");
        row2 = document.createElement("div");
        row1.className = "row col-xs-12";
        row1.appendChild(colDiv1_1);
        row1.appendChild(colDiv2_1);
        row1.appendChild(colDiv3_1);
        row2.className = "row col-xs-12";
        row2.appendChild(colDiv1_2);
        row2.appendChild(colDiv2_2);
        row2.appendChild(colDiv3_2);

        cardDiv.appendChild(rowBreak);
        cardDiv.appendChild(row1);
        cardDiv.appendChild(row2);

        return cardDiv;
    }
    
    // Loop over all activities and add them to the screen
    var len = activities.length;
    if (len > 10) {
        len = 10;
    }
    for (var i=0; i<activities.length; i++) {
        currDict = activities[i];
        var cardRow = document.getElementById("cardRow");
        
        var cardDiv = createCard(currDict, i);
        cardRow.appendChild(cardDiv);
    }
</script>

</html>
